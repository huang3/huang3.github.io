<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta lang="zh-CN"><meta name="X-UA-Compatible" content="IE=9"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="Huang Xiao"><meta name="description" content="We use &lt;a href=&quot;http://bokeh.pydata.org/en/latest/index.html&quot;&gt;&lt;b&gt;bokeh&lt;/b&gt;&lt;/a&gt; to visualize some common plots in Machine Learning, and we make some wrappers to make it even easier to use particularly for research."><meta name="keywords" content="machine learning,visualization,bokeh"><title>DataViz - Easy Visualization for Machine Learning · Xiao, Huang</title><link rel="icon" href="/favicon_h3.png"><link rel="canonical" href="http://huang3.github.io/2016/09/22/visualize-data/"><link rel="alternate" href="/atom.xml" title="Xiao, Huang"><link rel="stylesheet" href="/fonts/iconfont/iconfont.css"><link rel="stylesheet" href="/css/style.css"><script type="text/javascript"><!-- hexo-inject:begin --><!-- hexo-inject:end -->var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?Your baidu Analytics ID";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'Your Google Analytics ID', 'auto');
ga('send', 'pageview');</script><!-- hexo-inject:begin --><!-- hexo-inject:end --></head><body><div id="main"><header><a href="/." class="logo">Xiao, Huang</a><ul id="myTopnav" class="nav"><li class="navicon"><a href="javascript:void(0);" style="font-size:24px;" onclick="toggleNav()">&#9776;</a></li><li class="nav-link"><a href="/" target="_self">Home</a></li><li class="nav-link"><a href="/archives/" target="_self">Blogs</a></li><li class="nav-link"><a href="/projects/" target="_self">Projects</a></li><li class="nav-link"><a href="/vita/" target="_self">Vita</a></li></ul></header><div class="row"><div class="col-9"><article class="post"><h1 class="post-title">DataViz - Easy Visualization for Machine Learning</h1><span class="post-time">Sep 22, 2016</span><div class="post-content"><h2 id="dataviz-for-easy-plotting">DataViz for Easy Plotting</h2>
<!-- hexo-inject:begin --><!-- hexo-inject:end --><p>Ever since machine learning and big data are getting extremely popular, it makes total sense that we need a better way to look into what’s going on behind the data and model. There exists a number of frameworks you can leverage to produce figures on your demand, most popular ones like <a href="http://matplotlib.org/" target="_blank" rel="external">matplotlib</a>, <a href="http://seaborn.pydata.org/" target="_blank" rel="external">seaborn</a>, <a href="https://plot.ly/python/getting-started/" target="_blank" rel="external">plot.ly</a>, and also <a href="http://bokeh.pydata.org" target="_blank" rel="external">bokeh</a> which we use in this project. Of course, there’re many other choices.</p>
<p>I’ve been using matplotlib for quite a long time, it’s been regarded as a default plotting packages you need to install if you are using Python as your programing language for machine learning, however, it is now kinda of outdated, mainly because it does not support modern web browser very well, instead, other frameworks like bokeh and plot.ly originally are designed for deployment and share over website, they are deeply built with modern web technologies like javascript.</p>
<p>Frankly to say, I change to bokeh a while ago, because it does produce amazing figures and also with a number advantages to deploy your figures simply as a set of HTML files. I haven’t yet tired other frameworks, but as to my knowledge, bokeh is one of the most promising ones, plot.ly is also great, however I dislike their concept of plotting by API calls. I won’t bother discuss pro&amp;cons of different plotting frameworks, I chose bokeh since it does support both low level and higher level plotting functions, except that <strong>it does not support contour plot</strong>, for this I felt like really sorry, but you can find alternative solution too.</p>
<h2 id="motivation">Motivation</h2>
<p>So firstly I show a simple demonstration of how it should looks like in the end. <img src="http://home.in.tum.de/~xiaohu/uploaded_images/datavis_example.png" alt="demonstration of dataviz"> The three examples above are actually plotted for three kinds of purposes in data analytics. The main purpose of having this <kbd>DataViz</kbd> wrappers built beyond bokeh is to better facilitate my daily research. In machine learning, usually we are more interested at a certain number of plots. For instances, you build a model for a task, probably you wanna evaluate the model with varying parameters, then you will plot a validation curve with mean and standard deviation, w.r.t. different parameter settings. You will also be interested at a learning curve of how this model performs with respect the training size.</p>
<p>Even <kbd>scikit-learn</kbd> provides two very convenient functions for you to create these common curves. See examples below,</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> learning_curve</div><div class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> validation_curve</div><div class="line"></div><div class="line">...</div><div class="line">cvfolds = ShuffleSplit(n_splits=<span class="number">5</span>, test_size=<span class="number">0.2</span>)</div><div class="line">tr_sizes, tr_scores, tt_scores = \</div><div class="line">         learning_curve(estimator, n_jobs=<span class="number">-1</span>, X=Xtr, y=ytr, cv=cvfolds,</div><div class="line">                        train_sizes=np.linspace(<span class="number">0.1</span>, <span class="number">1</span>, <span class="number">5</span>), scoring=<span class="string">'accuracy'</span>)</div><div class="line">tr_scores, tt_scores = \</div><div class="line">         validation_curve(estimator=clf, param_name=eval_param, param_range=c_range,</div><div class="line">                          X=Xtr, y=ytr, scoring=scoring_str, n_jobs=<span class="number">-1</span>,</div><div class="line">                          cv=cvfolds, verbose=<span class="keyword">True</span>)</div></pre></td></tr></table></figure>
<p>The usage of these two curves are quite straightforward, I use it quite often in experiments. The <kbd>estimator</kbd> always corresponds to the classifier you build, which must have implemented <em>fit</em> and <em>prediction</em> methods, if you do not pass the <em>scoring</em> argument, you also need to implement an <em>estimator.score()</em> function in your estimator. Anyway, how to use these is out of scope for this post. If we look at the output, there are <em>tr_scores</em> and <em>tt_scores</em> which have dimension <kbd>x_sizes*n_folds</kbd>. <em>x_sizes</em> corresponds to the x-axis, and n_folds corresponds to the number of repetitions in your cross validation folds. At this point, it would be nice to have helper functions to directly generate plots with these arrays.</p>
<h2 id="bokeh">Bokeh</h2>
<p>Frankly to say, bokeh still has a lot to be improved, especially it does not provide contour/contourf plots, which I use a lot when I plot classification boundary or density maps. But it does really nice in support modern browsers. It can generate directly HTML files that can be deployed on your own website, or share with friends. And also it integrates seamlessly with Jupyter notebook, which allows you interactively play around it. Besides, another very nice feature is the widget and controls, like you can create Button/Checklist/Input Box very easily in bokeh, and make them response to your plots, with matplotlib to achieve these? a lot of pain in ass, it is afterall not designed as so.</p>
<h2 id="concept-of-dataviz">Concept of DataViz</h2>
<p>Simply use bokeh’s native API will just be fine to plot your data, however, I want to make it even simpler for my research purpose. That is every time if I wanna inspect a model or data or experimental results, I can present all the plots that I am interested in one simple web page. Using bokeh, I can easily achieve this.</p>
<p>Now the DataViz is simply a main class contains several plotting methods,</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">DataViz</span><span class="params">(object)</span>:</span></div><div class="line">   <span class="string">'''</span></div><div class="line">   A class for multiple common plotting functions for machine learning research</div><div class="line">   '''</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, config)</span>:</span></div><div class="line">      <span class="string">'''</span></div><div class="line">      init a DataViz obj for plotting dataset</div><div class="line">      :param config: configuration for plotting</div><div class="line">      :return: a figure handler of bokeh</div><div class="line">      '''      </div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">def</span> <span class="title">_get_figure_instance</span><span class="params">(self, ...)</span>:</span></div><div class="line">      <span class="string">'''</span></div><div class="line">      Return a figure with default setting</div><div class="line">      '''</div><div class="line">      fig = figure(...)</div><div class="line">      <span class="keyword">return</span> fig</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">def</span> <span class="title">feature_scatter1d</span><span class="params">(self, ...)</span>:</span></div><div class="line">      <span class="string">'''</span></div><div class="line">      Plot feature values along the x-axis</div><div class="line">      '''</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">def</span> <span class="title">project2d</span><span class="params">(self, ...)</span>:</span></div><div class="line">      <span class="string">'''</span></div><div class="line">      Project high-dimensiona data to 2D for visulaization</div><div class="line">      '''</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">def</span> <span class="title">plot_corr</span><span class="params">(self, ...)</span>:</span></div><div class="line">      <span class="string">'''</span></div><div class="line">      Correlation matrix plot</div><div class="line">      '''</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">def</span> <span class="title">fill_between</span><span class="params">(self, ...)</span>:</span></div><div class="line">      <span class="string">'''</span></div><div class="line">      Plot curves with fill area up and down</div><div class="line">      '''</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">def</span> <span class="title">simple_curves</span><span class="params">(self, ...)</span>:</span></div><div class="line">      <span class="string">'''</span></div><div class="line">      Simple curves</div><div class="line">      '''</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">def</span> <span class="title">send_to_server</span><span class="params">(self, server=..., port=.., user=<span class="string">"xxx"</span>, pw=<span class="string">"yyy"</span>)</span>:</span></div><div class="line">      <span class="string">'''</span></div><div class="line">      send plots to remote hosting server</div><div class="line">      '''</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">def</span> <span class="title">email_to</span><span class="params">(self, recipients=[], ... )</span>:</span></div><div class="line">      <span class="string">'''</span></div><div class="line">      Email the plots to recipients</div><div class="line">      '''</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">def</span> <span class="title">save_as</span><span class="params">(self, format=<span class="string">'html'</span>)</span>:</span></div><div class="line">      <span class="string">'''</span></div><div class="line">      Save the plots as certain format</div><div class="line">      '''</div></pre></td></tr></table></figure>
<p>The backbone code of the DataViz class is shown above. The basic idea is that one DataViz instance should represent a figure, where each method of DataViz returns a particular plot attaches to the figure. Each plotting method in the DataViz instance will firstly get a default plot configured by default settings. DataViz also provides other utilities, e.g., send the figure to server for hosting or email someone the plots.</p>
<p><strong>So, why bother to have this?</strong> given that you can basically directly use bokeh to achieve your goals. Well, this is more or less helpers for those who only cares the plots important in machine learning community. There’s of course tradeoff between usability and flexibility of any kind of frameworks. The higher you encapsulate, the more easier for you to use, but of course you lose your flexibility.</p>
<h2 id="plot-types">Plot Types</h2>
<p>We currently support following plots particularly for machine learning use cases, the list will be updated actively during my research needs. For the moment, I do not intend to publish the code, it’s just helpers anyway. But for those who really wanna give them a shot, just mail me to check if I can send you the code.</p>
<p>Currently we support only a few plot types, ofc, the list will be getting longer in the future.</p>
<h3 id="feature_scatter1d">feature_scatter1d</h3>
<p>This plot shows how the feature values distribute, along the x-axis are the indices of feature columns, and along the y-axis is the values of N data samples. By plotting it, you can get an overview of how is your data distributed, and decide afterwards how you’re gonna preprocess it. An example is shown below in Figure 1 (Left).</p>
<table>
<caption><strong>Figure 1: (Left) Feature scatter in 1D, x-axis indicates the index of features, y-axis shows the actual feature values. (Right) Data points are projected to lower dimension (2d) by PCA or other dimension reduction techniques.</strong></caption>
<tbody>
<tr class="odd">
<td align="left"><img src="http://home.in.tum.de/~xiaohu/uploaded_images/dataviz_featurescatter.png"></td>
<td align="left"><img src="http://home.in.tum.de/~xiaohu/uploaded_images/dataviz_project2d.png"></td>
</tr>
</tbody>
</table>
<h3 id="project2d">project2d</h3>
<p>The name of <em>project2d</em> is self-explanatory. We wanna see how data distributed in lower dimension, For example, If we have two categories of data, And we use different colors to annotate the data, Therefore we can get inside what is going on behind the observations. One example you can see in the table 1 (Right). This is actually a very common task when you first time get your data. Well normally you’re going to get a very high dimensional data, and the data will be transformed into 2 dimensional data using PCA algorithm or some other dimension reduction methods. Some examples are Multidimension Scaling (MDS), t-Distributed Stochastic Neighbor Embedding (t-SNE) and of course PCA/Kernel PCA. Those are all my favoriate ones. Before you start to learn any model from the data, it is a common practice to run them in order to see if there’s any insight behind it.</p>
<h3 id="correlation-map">Correlation map</h3>
<p>Another common plot you wanna check is the correlation map among features/targets. After computing the correlation on pairwise features and targets, you can see which features are strongly correlated, or you can see which features are obviously more decisive for targets. This is quite crucial at the first step, because you might do a feature selection before feeding a huge number of irrelevant features to your model. And it is usually the case that your observations are very sparse, only a small subset of features are relevant. An example is show in Figure 2.</p>
<div class="figure">
<img src="http://home.in.tum.de/~xiaohu/uploaded_images/dataviz_corr.png" alt="Figure 2: Correlation map among features and targets, blue means positive correlation, red means negative correlation.">
<p class="caption"><strong>Figure 2: Correlation map among features and targets, blue means positive correlation, red means negative correlation.</strong></p>
</div>
<h3 id="simple-curves-and-fill_between-curves">Simple curves and fill_between curves</h3>
<p>Simple curves and fill_between curves target on same type of plots, that is for instance, an error curve or learning curve described as before. The only difference is that fill_between provides a upper and lower bound over the actual curve, to present information such as error bars, standard variation over multiple repetitions of runs. See the Figure 3 for an example.</p>
<table>
<caption><strong>Figure 1: (Left) fill_between curves, the shaded area present standard deviation, and the solid line draws the mean. (Right) Simple curves only draw basic lines over XY-axis without providing more information.</strong></caption>
<tbody>
<tr class="odd">
<td align="left"><img src="http://home.in.tum.de/~xiaohu/uploaded_images/dataviz_fillbetween.png"></td>
<td align="left"><img src="http://home.in.tum.de/~xiaohu/uploaded_images/dataviz_simplecurve.png"></td>
</tr>
</tbody>
</table>
<h2 id="future-works">Future Works</h2>
<p>Visualizing your data and model correctly is crucial while you develop your learning systems, I always put a lot more emphasis on demonstrating the model, it is not only for your own insight, but as well as how your customers or supervisors can understand what you have achieved.</p>
<p>For the future, I plan to work out more type of plots which are relevant for machine learning community, for example, the contour/contourf plots, classification boundary, visualization of neural networks and so on. Besides, I also want to add facilities like better deployment of figures, widgets for better interaction for website and so on.</p>
</div></article></div><div class="col-3"><div id="sidebar" class="post-sidebar"><h3 class="heading">Contents</h3><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#dataviz-for-easy-plotting"><span class="toc-text">DataViz for Easy Plotting</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#motivation"><span class="toc-text">Motivation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bokeh"><span class="toc-text">Bokeh</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#concept-of-dataviz"><span class="toc-text">Concept of DataViz</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#plot-types"><span class="toc-text">Plot Types</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#feature_scatter1d"><span class="toc-text">feature_scatter1d</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#project2d"><span class="toc-text">project2d</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#correlation-map"><span class="toc-text">Correlation map</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#simple-curves-and-fill_between-curves"><span class="toc-text">Simple curves and fill_between curves</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#future-works"><span class="toc-text">Future Works</span></a></li></ol></div></div></div><div class="row"><div class="col-12"><div class="tags"><a href="/tags/machine-learning/">machine learning</a><a href="/tags/visualization/">visualization</a><a href="/tags/bokeh/">bokeh</a></div></div></div><div class="row"><div class="col-12">    <div class="paginator"><a href="/2016/09/22/intro-svc/" class="prev"><i class="iconfont icon-left"></i><span> Prev</span></a></div></div></div><div class="row"><div class="col-12"><section id="comments"><div id="disqus_thread"></div></section><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'http://huang3.github.io/2016/09/22/visualize-data/';
    this.page.identifier = '2016/09/22/visualize-data/';
    this.page.title = 'DataViz - Easy Visualization for Machine Learning';
};
(function() {
var d = document, s = d.createElement('script');

s.src = '//huang3.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();</script></div></div><footer><div class="copyright"><p class="power">Powered by <a href="https://hexo.io/">Hexo</a> and Theme by <a href="https://github.com/ahonn/hexo-theme-even"> Even</a></p><p class="since">&copy;2016<span class="heart"><i class="iconfont icon-heart"></i></span><span class="author">Huang Xiao</span></p></div><label id="back2top"><i class="iconfont icon-up"></i></label></footer></div><script src="/js/zepto.min.js"></script><script src="/js/theme.js"></script><script src="/js/particles.js"></script><script src="/js/myscript.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end --></body></html>